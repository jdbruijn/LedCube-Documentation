\hypertarget{_c_1_2_users_2jdebruijn_2_drive_2_programming_2_m_p_l_a_b_x_2_led_cube_8_x_2source_2_cube_control_2_led_driver_8h-example}{}\section{C\+:/\+Users/jdebruijn/\+Drive/\+Programming/\+M\+P\+L\+A\+B\+X/\+Led\+Cube.\+X/source/\+Cube\+Control/\+Led\+Driver.\+h}
Update the output of a L\+E\+D Sink Driver using the S\+P\+Ix peripheral.

\begin{DoxyNote}{Note}
The S\+P\+Ix module puts the data out M\+S\+B first. 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em \+\_\+led\+Data,16-\/bit} & variable to send to a L\+E\+D Sink Driver. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void
\end{DoxyReturn}

\begin{DoxyCode}
LED\_DRIVER\_LeLow();\(\backslash\)n
\hyperlink{_led_driver_8h_a5e8f1b876929be89fbd493f4df041895}{LedDriver\_update}(0xABCD);\(\backslash\)n
LED\_DRIVER\_SPI1WaitWhileBusy();\(\backslash\)n
LED\_DRIVER\_LeHigh();
\end{DoxyCode}



\begin{DoxyCodeInclude}
\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Begin of file LedDriver.h}
\textcolor{comment}{ * Author: jdebruijn}
\textcolor{comment}{ * Created on July 12, 2015, 11:27 AM}
\textcolor{comment}{ * }
\textcolor{comment}{ *~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*}
\textcolor{comment}{ * }
\textcolor{comment}{ * Copyright (c) 2015 Jeroen de Bruijn <vidavidorra@gmail.com>}
\textcolor{comment}{ * }
\textcolor{comment}{ * This file is part of LedCube which is released under The MIT License (MIT).}
\textcolor{comment}{ * For full license details see file "main.c" or "LICENSE.md" or go to}
\textcolor{comment}{ * https://opensource.org/licenses/MIT}
\textcolor{comment}{ * }
\textcolor{comment}{ *~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~*~**/}
\textcolor{preprocessor}{#ifndef LEDDRIVER\_H}
\textcolor{preprocessor}{#define LEDDRIVER\_H}

\textcolor{preprocessor}{#ifdef  \_\_cplusplus}
\textcolor{keyword}{extern} \textcolor{stringliteral}{"C"} \{
\textcolor{preprocessor}{#endif}

\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Switches}
\textcolor{comment}{ ******************************************************************************/}
\textcolor{preprocessor}{#define LD\_ENABLE\_SELF\_TEST\_NO}

\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Includes}
\textcolor{comment}{ ******************************************************************************/}
\textcolor{preprocessor}{#include <xc.h>}
\textcolor{preprocessor}{#include <stdint.h>}
\textcolor{preprocessor}{#include "System.h"}             \textcolor{comment}{// For calculating the SPI Clock (FCY)}
\textcolor{preprocessor}{#include "Debug.h"}
\textcolor{preprocessor}{#include "Ports.h"}
\textcolor{preprocessor}{#include "IOPorts.h"}

\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Defines}
\textcolor{comment}{ ******************************************************************************/}
\textcolor{preprocessor}{#define SPI1\_PPRE               1           }\textcolor{comment}{/* SPI1 Primary Prescale bits */}\textcolor{preprocessor}{}
\textcolor{preprocessor}{#define SPI1\_SPRE               2           }\textcolor{comment}{/* SPI1 Secondary Prescale bits */}\textcolor{preprocessor}{}
\textcolor{preprocessor}{#define SPI1\_FSCK               FCY / (SPI1\_PPRE * SPI1\_SPRE)}

\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Macros}
\textcolor{comment}{ ******************************************************************************/}
\textcolor{preprocessor}{#define LED\_DRIVER\_LeLow()      Port\_ClearPin(LD\_LE)}
\textcolor{preprocessor}{#define LED\_DRIVER\_LeHigh()     Port\_SetPin(LD\_LE)}
\textcolor{comment}{//@fixme does this actually work or need some other method of waiting?}
\textcolor{preprocessor}{#define SPI1\_WaitTillTxBufferEmpty() while( SPI1STATbits.SPITBF == 1 )}

\textcolor{preprocessor}{#define \_LED\_DRIVER\_ReorderLedData(ledData) ( ((ledData) & 0x0303) << 3 | \(\backslash\)}
\textcolor{preprocessor}{                ((ledData) & 0x0404)      | ((ledData) & 0x0808) << 2 | \(\backslash\)}
\textcolor{preprocessor}{                ((ledData) & 0x1010) >> 3 | ((ledData) & 0x2020) << 1 | \(\backslash\)}
\textcolor{preprocessor}{                ((ledData) & 0x4040) >> 6 | ((ledData) & 0x8080) )}

\textcolor{comment}{/*******************************************************************************}
\textcolor{comment}{ * Function prototypes}
\textcolor{comment}{ ******************************************************************************/}
\textcolor{keywordtype}{void}
\hyperlink{_led_driver_8h_ab6acead9b284609b765eeeffd49ef71c}{LedDriver\_init}( \textcolor{keywordtype}{void} );

\textcolor{keywordtype}{void}
\hyperlink{_led_driver_8h_a5e8f1b876929be89fbd493f4df041895}{LedDriver\_update}( \textcolor{keyword}{const} uint16\_t \_ledData );

\textcolor{keywordtype}{void}
\hyperlink{_led_driver_8h_a770bac51c657f55727e019d0a32cfa3f}{LedDriver\_allOff}( \textcolor{keywordtype}{void} );

\textcolor{keywordtype}{void}
\hyperlink{_led_driver_8h_a229365e5de1b33af936f9d1511748f78}{LedDriver\_allOn}( \textcolor{keywordtype}{void} );    

\textcolor{preprocessor}{#ifdef LD\_ENABLE\_SELF\_TEST\_YES    }

\textcolor{keywordtype}{void}
LedDriver\_selfTest( \textcolor{keywordtype}{void} );
\textcolor{preprocessor}{#endif }\textcolor{comment}{/* LD\_ENABLE\_SELF\_TEST\_YES */}\textcolor{preprocessor}{}

\textcolor{preprocessor}{#ifdef  \_\_cplusplus}
\}
\textcolor{preprocessor}{#endif}

\textcolor{preprocessor}{#endif  }\textcolor{comment}{/* LEDDRIVER\_H */}\textcolor{preprocessor}{}
\textcolor{comment}{/* End of file LedDriver.h */}
\end{DoxyCodeInclude}
 